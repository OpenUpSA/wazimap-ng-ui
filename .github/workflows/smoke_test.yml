name: "Build and smoke test the dockerfile"
on: [ push, pull_request ]
jobs:
  smoke_test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: docker build --tag wazimap-ng-ui .
      - run: docker run --publish 1234:1234 --detach --name wazimap-ng-ui wazimap-ng-ui
      - run: wget --retry-connrefused --waitretry=1 --read-timeout=10 --timeout=10 --tries=10 -O- http://localhost:1234 | tee smoketest.html | grep "This should also be mocked"

      - if: ${{ always() }}
        run: docker logs wazimap-ng-ui
      - if: ${{ failure() }}
        run: cat smoketest.html
